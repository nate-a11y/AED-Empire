{% comment %}
  Scrolling Marquee / Ticker
  Premium feature - endless scrolling text for announcements, promos, or branding
  Fully accessible with pause on hover/focus
{% endcomment %}

{%- liquid
  assign speed = section.settings.speed | default: 30
  assign direction = section.settings.direction | default: 'left'
  assign pause_on_hover = section.settings.pause_on_hover
-%}

<section
  class="scrolling-marquee {% if section.settings.full_width %}scrolling-marquee--full{% endif %}"
  style="
    --marquee-bg: {{ section.settings.background_color }};
    --marquee-text: {{ section.settings.text_color }};
    --marquee-speed: {{ speed }}s;
    --marquee-direction: {% if direction == 'right' %}reverse{% else %}normal{% endif %};
  "
  aria-label="Scrolling announcements"
  role="marquee"
>
  <div class="scrolling-marquee__track {% if pause_on_hover %}scrolling-marquee--pause-hover{% endif %}">
    <div class="scrolling-marquee__content" aria-hidden="false">
      {%- for block in section.blocks -%}
        <span class="scrolling-marquee__item" {{ block.shopify_attributes }}>
          {%- if block.settings.icon != blank -%}
            <span class="scrolling-marquee__icon">{{ block.settings.icon }}</span>
          {%- endif -%}
          {%- if block.settings.link != blank -%}
            <a href="{{ block.settings.link }}" class="scrolling-marquee__link">
              {{ block.settings.text }}
            </a>
          {%- else -%}
            {{ block.settings.text }}
          {%- endif -%}
        </span>
        {%- if section.settings.separator != blank -%}
          <span class="scrolling-marquee__separator" aria-hidden="true">{{ section.settings.separator }}</span>
        {%- endif -%}
      {%- endfor -%}
    </div>
    {%- comment -%} Duplicate for seamless loop {%- endcomment -%}
    <div class="scrolling-marquee__content" aria-hidden="true">
      {%- for block in section.blocks -%}
        <span class="scrolling-marquee__item">
          {%- if block.settings.icon != blank -%}
            <span class="scrolling-marquee__icon">{{ block.settings.icon }}</span>
          {%- endif -%}
          {%- if block.settings.link != blank -%}
            <a href="{{ block.settings.link }}" class="scrolling-marquee__link" tabindex="-1">
              {{ block.settings.text }}
            </a>
          {%- else -%}
            {{ block.settings.text }}
          {%- endif -%}
        </span>
        {%- if section.settings.separator != blank -%}
          <span class="scrolling-marquee__separator" aria-hidden="true">{{ section.settings.separator }}</span>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>

  {%- comment -%} Screen reader accessible static version {%- endcomment -%}
  <div class="visually-hidden">
    <ul>
      {%- for block in section.blocks -%}
        <li>{{ block.settings.text }}</li>
      {%- endfor -%}
    </ul>
  </div>

  {%- if section.settings.show_pause_button -%}
    <button
      type="button"
      class="scrolling-marquee__pause"
      aria-label="Pause scrolling announcements"
      data-marquee-pause
    >
      <span class="scrolling-marquee__pause-icon" data-pause-icon>‚è∏</span>
      <span class="scrolling-marquee__play-icon" data-play-icon style="display:none;">‚ñ∂</span>
    </button>
  {%- endif -%}
</section>

<style>
  .scrolling-marquee {
    background: var(--marquee-bg, var(--color-primary));
    color: var(--marquee-text, #fff);
    padding: 12px 0;
    overflow: hidden;
    position: relative;
  }
  .scrolling-marquee--full {
    padding: 16px 0;
  }
  .scrolling-marquee__track {
    display: flex;
    width: max-content;
    animation: marquee-scroll var(--marquee-speed) linear infinite;
    animation-direction: var(--marquee-direction);
  }
  .scrolling-marquee--pause-hover:hover,
  .scrolling-marquee--pause-hover:focus-within,
  .scrolling-marquee__track.is-paused {
    animation-play-state: paused;
  }
  @keyframes marquee-scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
  .scrolling-marquee__content {
    display: flex;
    align-items: center;
    gap: 30px;
    padding: 0 15px;
    white-space: nowrap;
  }
  .scrolling-marquee__item {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9375rem;
    font-weight: 500;
    letter-spacing: 0.5px;
  }
  .scrolling-marquee__icon {
    font-size: 1.125rem;
  }
  .scrolling-marquee__link {
    color: inherit;
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .scrolling-marquee__link:hover,
  .scrolling-marquee__link:focus {
    text-decoration: none;
  }
  .scrolling-marquee__separator {
    opacity: 0.5;
    font-weight: 300;
  }
  .scrolling-marquee__pause {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.2);
    border: none;
    color: inherit;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    transition: background 0.2s ease;
  }
  .scrolling-marquee__pause:hover,
  .scrolling-marquee__pause:focus {
    background: rgba(255,255,255,0.3);
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }
  @media (prefers-reduced-motion: reduce) {
    .scrolling-marquee__track {
      animation: none;
    }
    .scrolling-marquee__content:not(:first-child) {
      display: none;
    }
    .scrolling-marquee__content {
      flex-wrap: wrap;
      white-space: normal;
      justify-content: center;
    }
  }
</style>

<script>
  (function() {
    const pauseButtons = document.querySelectorAll('[data-marquee-pause]');

    pauseButtons.forEach(btn => {
      const marquee = btn.closest('.scrolling-marquee');
      const track = marquee.querySelector('.scrolling-marquee__track');
      const pauseIcon = btn.querySelector('[data-pause-icon]');
      const playIcon = btn.querySelector('[data-play-icon]');
      let isPaused = false;

      btn.addEventListener('click', () => {
        isPaused = !isPaused;
        track.classList.toggle('is-paused', isPaused);
        pauseIcon.style.display = isPaused ? 'none' : 'inline';
        playIcon.style.display = isPaused ? 'inline' : 'none';
        btn.setAttribute('aria-label', isPaused ? 'Play scrolling announcements' : 'Pause scrolling announcements');
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Scrolling Marquee",
  "tag": "section",
  "class": "section-scrolling-marquee",
  "settings": [
    {
      "type": "range",
      "id": "speed",
      "label": "Scroll speed (seconds)",
      "min": 10,
      "max": 60,
      "step": 5,
      "default": 30,
      "info": "Lower = faster"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Direction",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "text",
      "id": "separator",
      "label": "Separator between items",
      "default": "‚Ä¢"
    },
    {
      "type": "checkbox",
      "id": "pause_on_hover",
      "label": "Pause on hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pause_button",
      "label": "Show pause button",
      "default": false
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width (larger padding)",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Message",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Free Shipping on Orders Over $500"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon (emoji)",
          "info": "Optional emoji before text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Scrolling Marquee",
      "blocks": [
        {
          "type": "message",
          "settings": {
            "text": "Free Shipping on Orders Over $500",
            "icon": "üöö"
          }
        },
        {
          "type": "message",
          "settings": {
            "text": "AHA & Red Cross Certified Equipment",
            "icon": "‚úì"
          }
        },
        {
          "type": "message",
          "settings": {
            "text": "Expert Support Available 24/7",
            "icon": "üìû"
          }
        },
        {
          "type": "message",
          "settings": {
            "text": "Bulk Discounts for Organizations",
            "icon": "üíº"
          }
        }
      ]
    }
  ]
}
{% endschema %}

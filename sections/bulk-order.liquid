<section class="section{% if section.settings.alt_bg %} section--alt{% endif %}">
  <div class="container" style="max-width:900px">
    <div class="section-header">
      <h2>{{ section.settings.title }}</h2>
      {% if section.settings.subtitle %}<p>{{ section.settings.subtitle }}</p>{% endif %}
      <div class="section-header__divider"></div>
    </div>
    
    <form action="/cart/add" method="post" class="bulk-order-form">
      <table style="width:100%;border-collapse:collapse">
        <thead>
          <tr style="background:var(--color-secondary);color:#fff">
            <th style="padding:15px;text-align:left">Product</th>
            <th style="padding:15px;text-align:center;width:100px">Price</th>
            <th style="padding:15px;text-align:center;width:120px">Quantity</th>
          </tr>
        </thead>
        <tbody>
          {% for block in section.blocks %}
            {% assign product = all_products[block.settings.product] %}
            {% if product %}
              <tr style="border-bottom:1px solid var(--color-border)" {{ block.shopify_attributes }}>
                <td style="padding:15px">
                  <div style="display:flex;align-items:center;gap:15px">
                    <img src="{{ product.featured_image | image_url: width: 80 }}" alt="{{ product.title }}" style="width:60px;height:60px;object-fit:contain;border:1px solid var(--color-border)">
                    <div>
                      <a href="{{ product.url }}" style="font-weight:600">{{ product.title }}</a>
                      {% if product.variants.first.sku %}<br><small style="color:var(--color-text-light)">SKU: {{ product.variants.first.sku }}</small>{% endif %}
                    </div>
                  </div>
                </td>
                <td style="padding:15px;text-align:center;font-weight:700;color:var(--color-primary)">{{ product.price | money }}</td>
                <td style="padding:15px;text-align:center">
                  <input type="number" 
                         name="items[][quantity]" 
                         value="0" 
                         min="0" 
                         style="width:80px;padding:8px;text-align:center;border:1px solid var(--color-border)"
                         onchange="this.previousElementSibling.disabled = this.value == 0">
                  <input type="hidden" name="items[][id]" value="{{ product.selected_or_first_available_variant.id }}" disabled>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
      
      <div style="margin-top:30px;text-align:center">
        <button type="submit" class="btn btn--primary btn--large">Add Selected to Cart</button>
        <p style="margin-top:15px;font-size:.875rem;color:var(--color-text-light)">
          Need 10+ units? <a href="/pages/contact">Request a volume quote</a>
        </p>
      </div>
    </form>
  </div>
</section>

<script>
document.querySelector('.bulk-order-form')?.addEventListener('submit', function(e) {
  // Enable only inputs with quantity > 0
  this.querySelectorAll('input[type="number"]').forEach(function(input) {
    var hidden = input.nextElementSibling;
    hidden.disabled = parseInt(input.value) === 0;
  });
});
</script>

{% schema %}
{
  "name": "Bulk order form",
  "settings": [
    {"type":"text","id":"title","label":"Heading","default":"Quick Order Form"},
    {"type":"text","id":"subtitle","label":"Subtitle","default":"Add multiple products to your cart at once"},
    {"type":"checkbox","id":"alt_bg","label":"Alternate background","default":false}
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {"type":"product","id":"product","label":"Product"}
      ]
    }
  ],
  "presets": [{"name":"Bulk order form"}]
}
{% endschema %}

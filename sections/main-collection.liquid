<div class="collection-page">
  <div class="container">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Home</a>
      <span class="breadcrumbs__sep">/</span>
      <span aria-current="page">{{ collection.title }}</span>
    </nav>

    <header class="collection-header">
      <h1>{{ collection.title }}</h1>
      {% if collection.description != blank %}
        {% assign desc_text = collection.description | strip_html %}
        <p class="collection-header__intro">{{ desc_text | truncate: 160, '...' }}</p>
      {% endif %}
    </header>

    <div class="collection-layout">
      <!-- Sidebar Filters -->
      <aside class="collection-filters" data-filters>
        <div class="collection-filters__header">
          <h3>Filters</h3>
          <button class="collection-filters__clear" data-clear-filters>Clear All</button>
        </div>

        <!-- Price Filter -->
        <div class="filter-group" data-filter-group>
          <button class="filter-group__toggle" aria-expanded="true">
            Price
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="filter-group__content">
            {% assign price_ranges = 'Under $500|$500 - $1000|$1000 - $2000|Over $2000' | split: '|' %}
            {% for range in price_ranges %}
              <label class="filter-option">
                <input type="checkbox" name="price" value="{{ range | handleize }}" data-filter="price">
                <span>{{ range }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <!-- Brand Filter (from vendors) -->
        {% assign vendors = collection.products | map: 'vendor' | uniq | sort %}
        {% if vendors.size > 1 %}
          <div class="filter-group" data-filter-group>
            <button class="filter-group__toggle" aria-expanded="true">
              Brand
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <div class="filter-group__content">
              {% for vendor in vendors %}
                <label class="filter-option">
                  <input type="checkbox" name="vendor" value="{{ vendor | handleize }}" data-filter="vendor">
                  <span>{{ vendor }}</span>
                </label>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Tag-based Filters -->
        {% assign all_tags = collection.all_tags %}
        {% assign feature_tags = '' | split: '' %}
        {% assign type_tags = '' | split: '' %}
        {% for tag in all_tags %}
          {% if tag contains 'feature:' %}
            {% assign feature_tags = feature_tags | push: tag %}
          {% elsif tag contains 'type:' %}
            {% assign type_tags = type_tags | push: tag %}
          {% endif %}
        {% endfor %}

        {% if feature_tags.size > 0 %}
          <div class="filter-group" data-filter-group>
            <button class="filter-group__toggle" aria-expanded="true">
              Features
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <div class="filter-group__content">
              {% for tag in feature_tags %}
                {% assign clean_tag = tag | remove: 'feature:' %}
                <label class="filter-option">
                  <input type="checkbox" name="tag" value="{{ tag | handleize }}" data-filter="tag">
                  <span>{{ clean_tag }}</span>
                </label>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Availability Filter -->
        <div class="filter-group" data-filter-group>
          <button class="filter-group__toggle" aria-expanded="true">
            Availability
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="filter-group__content">
            <label class="filter-option">
              <input type="checkbox" name="availability" value="in-stock" data-filter="availability">
              <span>In Stock</span>
            </label>
          </div>
        </div>
      </aside>

      <!-- Mobile Filter Toggle -->
      <button class="collection-filter-toggle" data-filter-toggle>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
        Filters
      </button>

      <!-- Products Grid -->
      <div class="collection-main">
        <div class="collection-toolbar">
          <p class="collection-toolbar__count">
            <span data-product-count>{{ collection.products_count }}</span> products
          </p>
          
          <div class="collection-toolbar__actions">
            <div class="collection-toolbar__view">
              <button class="view-toggle view-toggle--active" data-view="grid" aria-label="Grid view">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
              </button>
              <button class="view-toggle" data-view="list" aria-label="List view">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="4"/><rect x="3" y="10" width="18" height="4"/><rect x="3" y="16" width="18" height="4"/></svg>
              </button>
            </div>

            <div class="collection-toolbar__sort">
              <label for="sort-by" class="visually-hidden">Sort by</label>
              <select id="sort-by" data-sort-select>
                <option value="manual">Featured</option>
                <option value="best-selling">Best Selling</option>
                <option value="title-ascending">A-Z</option>
                <option value="title-descending">Z-A</option>
                <option value="price-ascending">Price: Low to High</option>
                <option value="price-descending">Price: High to Low</option>
                <option value="created-descending">Newest</option>
              </select>
            </div>
          </div>
        </div>

        <div class="collection-grid" data-collection-grid>
          {% paginate collection.products by section.settings.products_per_page %}
            {% for product in collection.products %}
              {% render 'product-card', product: product, show_quick_view: true %}
            {% endfor %}
          {% endpaginate %}
        </div>

        {% paginate collection.products by section.settings.products_per_page %}
          {% render 'pagination', paginate: paginate, anchor: '#collection-products' %}
        {% endpaginate %}
      </div>
    </div>

    <!-- Collection Description (below products, accordion format) -->
    {% if collection.description != blank %}
      {% assign desc_has_headings = collection.description | split: '<h2' | size | minus: 1 %}
      {% assign desc_has_h3 = collection.description | split: '<h3' | size | minus: 1 %}
      {% assign total_headings = desc_has_headings | plus: desc_has_h3 %}

      {% if total_headings > 0 %}
        <section class="collection-info">
          <h2 class="collection-info__title">About {{ collection.title }}</h2>
          <div class="collection-info__content rte" data-content-accordion="h2,h3">
            {{ collection.description }}
          </div>
        </section>
      {% else %}
        <section class="collection-info">
          <h2 class="collection-info__title">About {{ collection.title }}</h2>
          <div class="collection-info__content rte">
            {{ collection.description }}
          </div>
        </section>
      {% endif %}
    {% endif %}
  </div>
</div>

<!-- Quick View Modal -->
{% render 'quick-view' %}

{% schema %}
{
  "name": "Collection page",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 48,
      "step": 4,
      "label": "Products per page",
      "default": 16
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 3,
      "max": 5,
      "step": 1,
      "label": "Desktop columns",
      "default": 4
    }
  ]
}
{% endschema %}

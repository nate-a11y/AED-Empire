{% doc %}
  @name Product Badges
  @description Renders contextual product badges based on product state and tags.
  Supports sale (with percentage), sold out, new (within 30 days), refurbished,
  FDA certified, bestseller, value bundle, and free shipping badges.

  @param {product} product - The product object to generate badges for (required)

  @example
    {% render 'product-badges', product: product %}
{% enddoc %}

{%- liquid
  assign show_badges = true
  assign badges = ''

  # Check for sale
  if product.compare_at_price > product.price
    assign savings = product.compare_at_price | minus: product.price
    assign savings_percent = savings | times: 100.0 | divided_by: product.compare_at_price | round
    assign badges = badges | append: 'sale,'
  endif

  # Check for sold out
  unless product.available
    assign badges = badges | append: 'soldout,'
  endunless

  # Check for new (within 30 days)
  assign now = 'now' | date: '%s'
  assign published = product.published_at | date: '%s'
  assign diff = now | minus: published
  assign days_old = diff | divided_by: 86400
  if days_old < 30 and product.available
    assign badges = badges | append: 'new,'
  endif

  # Check for refurbished/recertified (via tags or metafield)
  for tag in product.tags
    assign tag_lower = tag | downcase
    if tag_lower contains 'refurbished' or tag_lower contains 'recertified' or tag_lower contains 'renewed'
      assign badges = badges | append: 'refurbished,'
      break
    endif
    if tag_lower contains 'certified' or tag_lower contains 'fda'
      assign badges = badges | append: 'certified,'
    endif
    if tag_lower contains 'best-seller' or tag_lower contains 'bestseller' or tag_lower contains 'popular'
      assign badges = badges | append: 'bestseller,'
    endif
    if tag_lower contains 'bundle' or tag_lower contains 'package' or tag_lower contains 'value'
      assign badges = badges | append: 'bundle,'
    endif
    if tag_lower contains 'free-shipping' or tag_lower contains 'free shipping'
      assign badges = badges | append: 'freeship,'
    endif
  endfor

  assign badges_array = badges | split: ','
-%}

{% if badges_array.size > 0 %}
  <div class="product-badges">
    {% for badge in badges_array %}
      {% case badge %}
        {% when 'sale' %}
          <span class="product-badge product-badge--sale">
            Save {{ savings_percent }}%
          </span>
        {% when 'soldout' %}
          <span class="product-badge product-badge--soldout">
            Sold Out
          </span>
        {% when 'new' %}
          <span class="product-badge product-badge--new">
            New
          </span>
        {% when 'refurbished' %}
          <span class="product-badge product-badge--refurbished">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-9-9c2.52 0 4.85.83 6.72 2.24"/><polyline points="21 3 21 9 15 9"/></svg>
            Certified Refurbished
          </span>
        {% when 'certified' %}
          <span class="product-badge product-badge--certified">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            FDA Certified
          </span>
        {% when 'bestseller' %}
          <span class="product-badge product-badge--bestseller">
            Best Seller
          </span>
        {% when 'bundle' %}
          <span class="product-badge product-badge--bundle">
            Value Bundle
          </span>
        {% when 'freeship' %}
          <span class="product-badge product-badge--freeship">
            Free Shipping
          </span>
      {% endcase %}
    {% endfor %}
  </div>
{% endif %}

{% stylesheet %}
.product-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 5;
}

.product-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 5px 10px;
  font-size: 0.6875rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: 3px;
  line-height: 1;
}

.product-badge svg {
  flex-shrink: 0;
}

.product-badge--sale {
  background: var(--color-primary);
  color: #fff;
}

.product-badge--soldout {
  background: #6c757d;
  color: #fff;
}

.product-badge--new {
  background: var(--color-success);
  color: #fff;
}

.product-badge--refurbished {
  background: var(--color-secondary);
  color: #fff;
}

.product-badge--certified {
  background: var(--color-accent);
  color: #fff;
}

.product-badge--bestseller {
  background: oklch(0.85 0.15 85); /* OKLCH gold */
  color: #1a1a1a;
}

.product-badge--bundle {
  background: oklch(0.5 0.2 300); /* OKLCH purple */
  color: #fff;
}

.product-badge--freeship {
  background: var(--color-success);
  color: #fff;
}
{% endstylesheet %}
